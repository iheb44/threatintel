# PII (Personally Identifiable Information) Detection Rule

name: "PII Data Breach Detected"
type: any
index: posts*
timestamp_field: timestamp
is_enabled: true

run_every:
  minutes: 5

buffer_time:
  minutes: 15

# Detect PII patterns using regex
filter:
- query:
    bool:
      should:
        # Social Security Numbers
        - regexp:
            text: "[0-9]{3}-[0-9]{2}-[0-9]{4}"
        - regexp:
            text: "[0-9]{9}"
        
        # Credit Card Numbers
        - regexp:
            text: "4[0-9]{12}(?:[0-9]{3})?"  # Visa
        - regexp:
            text: "5[1-5][0-9]{14}"          # MasterCard
        - regexp:
            text: "3[47][0-9]{13}"           # American Express
        
        # Email:Password combinations
        - regexp:
            text: "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}:[a-zA-Z0-9!@#$%^&*]+"
        
        # Database dump indicators
        - match_phrase:
            text: "username"
        - match_phrase:
            text: "password hash"
        - match_phrase:
            text: "user_id"
            
      minimum_should_match: 1

include:
  - title
  - url
  - source_site
  - timestamp
  - entities

alert:
  - "debug"

alert_subject: "üî¥ PII BREACH ALERT: Sensitive Data Detected"

alert_text: |
  **URGENT: Personal Identifiable Information Detected!**
  
  üö® **Breach Details:**
  - **Source:** {0}
  - **URL:** {1}
  - **Time:** {2}
  - **Title:** {3}
  
  üîç **Extracted Entities:**
  {4}
  
  ‚ö†Ô∏è **IMMEDIATE ACTION REQUIRED**
  This may indicate a data breach affecting your organization or customers.

alert_text_args:
  - source_site
  - url
  - timestamp
  - title
  - entities

realert:
  hours: 1
